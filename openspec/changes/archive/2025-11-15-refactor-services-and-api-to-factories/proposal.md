# Change: Create Generic Factories for Services and API Routes

## Why
The service files in `@domain-k8s/services` and the API route handlers in `src/app/api` contain a significant amount of repetitive boilerplate code. For each Kubernetes resource, the logic for listing, getting details, and handling HTTP routing is nearly identical—excluding a few special cases such as `/connect`, `/search`, `events`, and other endpoints whose shapes diverge from the standard “list/detail/events” contract. A factory approach needs to account for both the common case and these exceptions.

This duplication makes the codebase larger than necessary and increases the effort required to add new resource types. A developer has to copy, paste, and modify several files just to expose a new Kubernetes resource.

## What Changes
This proposal introduces a factory-based approach to reduce this boilerplate while explicitly handling exceptions:

1.  **Generic Resource Service:** Create a `createResourceService` factory in `@domain-k8s`. This factory will take a resource-specific configuration (e.g., the API client methods for list/read, and the transformer functions) and return a fully-formed service object with standard `list` and `getDetail` methods.
2.  **Generic API Route Handler:** Create a `createApiRouteHandlers` factory. This factory will take a resource service object (generated by the above factory) and automatically generate the `GET` handler for the API route. This handler will include all the standard routing logic (e.g., `/`, `/{ns}`, `/{ns}/{name}`, `/{ns}/{name}/events`) while allowing hook points for routes that do not have namespaces, have additional sub-resources, or should opt out.
3.  **Refactor:** Refactor the existing services and API routes incrementally—starting with Pods—to use these new, streamlined factories. Non-standard endpoints will either leverage extension hooks or remain bespoke with documentation.

## Impact
- **Specs**: None. This is a purely backend architectural refactoring.
- **Code**: Will affect most files in `@domain-k8s/services/` and `src/app/api/k8s/`. It will introduce two new factory functions and significantly reduce the line count in the affected files, while providing escape hatches for non-standard routes.
- **Risk**: Medium. The refactoring touches all the data-fetching pathways for Kubernetes resources, so the work will be delivered incrementally (Pods → Deployments → …) with verification after each migration to keep the blast radius contained.
